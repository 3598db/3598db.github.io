<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>â­ï¸snabbdomæºç åˆ†æ | DailyClack:))</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.png">
    <meta name="description" content="Do not go gentle into that good night.">
    
    <link rel="preload" href="/assets/css/0.styles.21e7d717.css" as="style"><link rel="preload" href="/assets/js/app.1690ea5b.js" as="script"><link rel="preload" href="/assets/js/2.8b426e0b.js" as="script"><link rel="preload" href="/assets/js/133.77ef3752.js" as="script"><link rel="prefetch" href="/assets/js/10.b4249a64.js"><link rel="prefetch" href="/assets/js/100.d2ed3062.js"><link rel="prefetch" href="/assets/js/101.82e5255c.js"><link rel="prefetch" href="/assets/js/102.57b66d79.js"><link rel="prefetch" href="/assets/js/103.68ac3415.js"><link rel="prefetch" href="/assets/js/104.bdb66e38.js"><link rel="prefetch" href="/assets/js/105.3ffc704c.js"><link rel="prefetch" href="/assets/js/106.155fc0ef.js"><link rel="prefetch" href="/assets/js/107.d9f013b0.js"><link rel="prefetch" href="/assets/js/108.2d7585e5.js"><link rel="prefetch" href="/assets/js/109.deea2371.js"><link rel="prefetch" href="/assets/js/11.7b715a0d.js"><link rel="prefetch" href="/assets/js/110.6424ba3f.js"><link rel="prefetch" href="/assets/js/111.9143eef7.js"><link rel="prefetch" href="/assets/js/112.e1b93c71.js"><link rel="prefetch" href="/assets/js/113.b6eca80e.js"><link rel="prefetch" href="/assets/js/114.31acb673.js"><link rel="prefetch" href="/assets/js/115.9f81939f.js"><link rel="prefetch" href="/assets/js/116.0a880c6e.js"><link rel="prefetch" href="/assets/js/117.15928222.js"><link rel="prefetch" href="/assets/js/118.572b9798.js"><link rel="prefetch" href="/assets/js/119.0928b6b7.js"><link rel="prefetch" href="/assets/js/12.8a7aa936.js"><link rel="prefetch" href="/assets/js/120.239fac2c.js"><link rel="prefetch" href="/assets/js/121.18c5bb8c.js"><link rel="prefetch" href="/assets/js/122.5ea3cec9.js"><link rel="prefetch" href="/assets/js/123.c20cc51f.js"><link rel="prefetch" href="/assets/js/124.f92dc613.js"><link rel="prefetch" href="/assets/js/125.789a0cf6.js"><link rel="prefetch" href="/assets/js/126.c57c880c.js"><link rel="prefetch" href="/assets/js/127.10838350.js"><link rel="prefetch" href="/assets/js/128.8d4fe70b.js"><link rel="prefetch" href="/assets/js/129.ac5584b9.js"><link rel="prefetch" href="/assets/js/13.06f93efa.js"><link rel="prefetch" href="/assets/js/130.bf6abaa1.js"><link rel="prefetch" href="/assets/js/131.090de7bd.js"><link rel="prefetch" href="/assets/js/132.9ca4fb47.js"><link rel="prefetch" href="/assets/js/134.490871a9.js"><link rel="prefetch" href="/assets/js/135.fe01f391.js"><link rel="prefetch" href="/assets/js/136.e014c7a8.js"><link rel="prefetch" href="/assets/js/137.21468943.js"><link rel="prefetch" href="/assets/js/138.c29ed5f4.js"><link rel="prefetch" href="/assets/js/139.91c25477.js"><link rel="prefetch" href="/assets/js/14.21f3c2e8.js"><link rel="prefetch" href="/assets/js/140.1a620ca6.js"><link rel="prefetch" href="/assets/js/141.59f02fe4.js"><link rel="prefetch" href="/assets/js/142.f156fffa.js"><link rel="prefetch" href="/assets/js/143.255d8be1.js"><link rel="prefetch" href="/assets/js/144.f67c812f.js"><link rel="prefetch" href="/assets/js/145.8a8e4a2a.js"><link rel="prefetch" href="/assets/js/146.78d38cbc.js"><link rel="prefetch" href="/assets/js/147.1f3b713f.js"><link rel="prefetch" href="/assets/js/148.6328d40a.js"><link rel="prefetch" href="/assets/js/149.f7e71491.js"><link rel="prefetch" href="/assets/js/15.058a09a2.js"><link rel="prefetch" href="/assets/js/150.0884a870.js"><link rel="prefetch" href="/assets/js/151.77ce5077.js"><link rel="prefetch" href="/assets/js/152.4abd819f.js"><link rel="prefetch" href="/assets/js/153.4ea1b82e.js"><link rel="prefetch" href="/assets/js/154.bfaad546.js"><link rel="prefetch" href="/assets/js/155.b4774e19.js"><link rel="prefetch" href="/assets/js/156.4c70b0f3.js"><link rel="prefetch" href="/assets/js/157.95d9bd28.js"><link rel="prefetch" href="/assets/js/158.f30d58f4.js"><link rel="prefetch" href="/assets/js/159.5d6eff00.js"><link rel="prefetch" href="/assets/js/16.79e1c3f4.js"><link rel="prefetch" href="/assets/js/160.3b4ea212.js"><link rel="prefetch" href="/assets/js/161.a67cfeb0.js"><link rel="prefetch" href="/assets/js/162.118cbee5.js"><link rel="prefetch" href="/assets/js/163.7867d86e.js"><link rel="prefetch" href="/assets/js/164.a20d0e04.js"><link rel="prefetch" href="/assets/js/165.fc35259c.js"><link rel="prefetch" href="/assets/js/166.3b31baca.js"><link rel="prefetch" href="/assets/js/167.942c22a1.js"><link rel="prefetch" href="/assets/js/168.57f429d1.js"><link rel="prefetch" href="/assets/js/169.d0615ea2.js"><link rel="prefetch" href="/assets/js/17.2ea7c271.js"><link rel="prefetch" href="/assets/js/170.db44c4f5.js"><link rel="prefetch" href="/assets/js/171.94665a62.js"><link rel="prefetch" href="/assets/js/172.9b016b91.js"><link rel="prefetch" href="/assets/js/173.0ce8f193.js"><link rel="prefetch" href="/assets/js/174.d5e3e2e7.js"><link rel="prefetch" href="/assets/js/175.e4ff0818.js"><link rel="prefetch" href="/assets/js/176.1dfacce8.js"><link rel="prefetch" href="/assets/js/177.cb157261.js"><link rel="prefetch" href="/assets/js/178.014559b7.js"><link rel="prefetch" href="/assets/js/179.1ebb77d4.js"><link rel="prefetch" href="/assets/js/18.91e124f7.js"><link rel="prefetch" href="/assets/js/180.a635fa28.js"><link rel="prefetch" href="/assets/js/181.72d5610e.js"><link rel="prefetch" href="/assets/js/182.cefd1fa1.js"><link rel="prefetch" href="/assets/js/183.e684e5b3.js"><link rel="prefetch" href="/assets/js/184.b4761c6c.js"><link rel="prefetch" href="/assets/js/185.08e77978.js"><link rel="prefetch" href="/assets/js/186.7197c118.js"><link rel="prefetch" href="/assets/js/187.cef57676.js"><link rel="prefetch" href="/assets/js/188.ddedcd97.js"><link rel="prefetch" href="/assets/js/189.c59b23a5.js"><link rel="prefetch" href="/assets/js/19.7804539c.js"><link rel="prefetch" href="/assets/js/190.aca184e4.js"><link rel="prefetch" href="/assets/js/191.1fc9a77e.js"><link rel="prefetch" href="/assets/js/192.56203342.js"><link rel="prefetch" href="/assets/js/193.72d88b09.js"><link rel="prefetch" href="/assets/js/194.05f30d33.js"><link rel="prefetch" href="/assets/js/195.f85beac8.js"><link rel="prefetch" href="/assets/js/196.8e5e81de.js"><link rel="prefetch" href="/assets/js/197.c0ac31d4.js"><link rel="prefetch" href="/assets/js/198.3ce990eb.js"><link rel="prefetch" href="/assets/js/199.e0444803.js"><link rel="prefetch" href="/assets/js/20.b8761bfc.js"><link rel="prefetch" href="/assets/js/200.713a2cca.js"><link rel="prefetch" href="/assets/js/201.bcb0ca06.js"><link rel="prefetch" href="/assets/js/202.264c22fc.js"><link rel="prefetch" href="/assets/js/203.889bdc28.js"><link rel="prefetch" href="/assets/js/204.63ae886e.js"><link rel="prefetch" href="/assets/js/205.cdebce49.js"><link rel="prefetch" href="/assets/js/21.175e2e46.js"><link rel="prefetch" href="/assets/js/22.75bedabf.js"><link rel="prefetch" href="/assets/js/23.225e9bd4.js"><link rel="prefetch" href="/assets/js/24.cdee11cc.js"><link rel="prefetch" href="/assets/js/25.a9bcf824.js"><link rel="prefetch" href="/assets/js/26.a258a9cc.js"><link rel="prefetch" href="/assets/js/27.c91035b4.js"><link rel="prefetch" href="/assets/js/28.3d2e1e58.js"><link rel="prefetch" href="/assets/js/29.b229f9a6.js"><link rel="prefetch" href="/assets/js/3.ea542717.js"><link rel="prefetch" href="/assets/js/30.4c82874f.js"><link rel="prefetch" href="/assets/js/31.485a22e3.js"><link rel="prefetch" href="/assets/js/32.ee904b6e.js"><link rel="prefetch" href="/assets/js/33.b2edc1fc.js"><link rel="prefetch" href="/assets/js/34.720bd9ab.js"><link rel="prefetch" href="/assets/js/35.2d4556c2.js"><link rel="prefetch" href="/assets/js/36.4b9986d5.js"><link rel="prefetch" href="/assets/js/37.2382f1ed.js"><link rel="prefetch" href="/assets/js/38.c97bd080.js"><link rel="prefetch" href="/assets/js/39.fa96d23d.js"><link rel="prefetch" href="/assets/js/4.7f66c088.js"><link rel="prefetch" href="/assets/js/40.9767bc7c.js"><link rel="prefetch" href="/assets/js/41.fc2663cb.js"><link rel="prefetch" href="/assets/js/42.4febd707.js"><link rel="prefetch" href="/assets/js/43.75bf45d0.js"><link rel="prefetch" href="/assets/js/44.28247673.js"><link rel="prefetch" href="/assets/js/45.0c21b9ec.js"><link rel="prefetch" href="/assets/js/46.d1e9a2ee.js"><link rel="prefetch" href="/assets/js/47.7578c041.js"><link rel="prefetch" href="/assets/js/48.ad301eec.js"><link rel="prefetch" href="/assets/js/49.952f44b7.js"><link rel="prefetch" href="/assets/js/5.788fc2c6.js"><link rel="prefetch" href="/assets/js/50.9561eb4d.js"><link rel="prefetch" href="/assets/js/51.622dde08.js"><link rel="prefetch" href="/assets/js/52.7d1385e5.js"><link rel="prefetch" href="/assets/js/53.3736c0df.js"><link rel="prefetch" href="/assets/js/54.eafb2673.js"><link rel="prefetch" href="/assets/js/55.4407a20b.js"><link rel="prefetch" href="/assets/js/56.78773290.js"><link rel="prefetch" href="/assets/js/57.beaa65ec.js"><link rel="prefetch" href="/assets/js/58.00ec64ea.js"><link rel="prefetch" href="/assets/js/59.7be0dbd3.js"><link rel="prefetch" href="/assets/js/6.5334eda4.js"><link rel="prefetch" href="/assets/js/60.21b53ecd.js"><link rel="prefetch" href="/assets/js/61.2cd0a41e.js"><link rel="prefetch" href="/assets/js/62.283dd811.js"><link rel="prefetch" href="/assets/js/63.d400c5ba.js"><link rel="prefetch" href="/assets/js/64.dd32c429.js"><link rel="prefetch" href="/assets/js/65.d27371c8.js"><link rel="prefetch" href="/assets/js/66.6ab456d2.js"><link rel="prefetch" href="/assets/js/67.a53055fc.js"><link rel="prefetch" href="/assets/js/68.d40429e2.js"><link rel="prefetch" href="/assets/js/69.5b2b43f6.js"><link rel="prefetch" href="/assets/js/7.edf2adb9.js"><link rel="prefetch" href="/assets/js/70.3c092199.js"><link rel="prefetch" href="/assets/js/71.8d40b052.js"><link rel="prefetch" href="/assets/js/72.b43969f8.js"><link rel="prefetch" href="/assets/js/73.92e908e6.js"><link rel="prefetch" href="/assets/js/74.9222c7d1.js"><link rel="prefetch" href="/assets/js/75.9206ddef.js"><link rel="prefetch" href="/assets/js/76.55c11690.js"><link rel="prefetch" href="/assets/js/77.8ef04673.js"><link rel="prefetch" href="/assets/js/78.8524533a.js"><link rel="prefetch" href="/assets/js/79.b4fac536.js"><link rel="prefetch" href="/assets/js/8.cdd2ace8.js"><link rel="prefetch" href="/assets/js/80.27bd61ba.js"><link rel="prefetch" href="/assets/js/81.06046cc9.js"><link rel="prefetch" href="/assets/js/82.f4ad3f32.js"><link rel="prefetch" href="/assets/js/83.e56d08c1.js"><link rel="prefetch" href="/assets/js/84.917f4539.js"><link rel="prefetch" href="/assets/js/85.ba572d7f.js"><link rel="prefetch" href="/assets/js/86.ac731983.js"><link rel="prefetch" href="/assets/js/87.a89a9da5.js"><link rel="prefetch" href="/assets/js/88.10dc15a1.js"><link rel="prefetch" href="/assets/js/89.9bde578f.js"><link rel="prefetch" href="/assets/js/9.f68028e8.js"><link rel="prefetch" href="/assets/js/90.ba0ee89b.js"><link rel="prefetch" href="/assets/js/91.90554a0e.js"><link rel="prefetch" href="/assets/js/92.95e065c5.js"><link rel="prefetch" href="/assets/js/93.0217650a.js"><link rel="prefetch" href="/assets/js/94.8e61d7d0.js"><link rel="prefetch" href="/assets/js/95.e9e39a74.js"><link rel="prefetch" href="/assets/js/96.d73f72cd.js"><link rel="prefetch" href="/assets/js/97.92a26f1b.js"><link rel="prefetch" href="/assets/js/98.9e8f3b67.js"><link rel="prefetch" href="/assets/js/99.a76aec74.js">
    <link rel="stylesheet" href="/assets/css/0.styles.21e7d717.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DailyClack:))</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Home</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/001_home/todos.html" class="sidebar-link">åœŸè±† ğŸ’¡</a></li><li><a href="/articles/001_home/bookmark.html" class="sidebar-link">ä¹¦ç­¾ ğŸ––</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>q&amp;a</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/000_qa/000001_algorithm.html" class="sidebar-link">ğŸ¤”æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a href="/articles/000_qa/000002_browser.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨</a></li><li><a href="/articles/000_qa/000003_css.html" class="sidebar-link">ğŸ¤”CSS</a></li><li><a href="/articles/000_qa/000004_ecmascript.html" class="sidebar-link">ğŸ¤”ECMAScript</a></li><li><a href="/articles/000_qa/000005_write.html" class="sidebar-link">ğŸ¤”æ‰‹å†™ä»£ç </a></li><li><a href="/articles/000_qa/000006_engineering.html" class="sidebar-link">ğŸ¤”å·¥ç¨‹åŒ–</a></li><li><a href="/articles/000_qa/000007_framework.html" class="sidebar-link">ğŸ¤”æ¡†æ¶</a></li><li><a href="/articles/000_qa/000008_network.html" class="sidebar-link">ğŸ¤”ç½‘ç»œ</a></li><li><a href="/articles/000_qa/000009_nodejs.html" class="sidebar-link">ğŸ¤”Nodejs</a></li><li><a href="/articles/000_qa/000010_open.html" class="sidebar-link">ğŸ¤”å¼€æ”¾é—®é¢˜</a></li><li><a href="/articles/000_qa/000011_links.html" class="sidebar-link">ğŸ¤”é“¾æ¥æ±‡æ€»</a></li><li><a href="/articles/000_qa/000012_pics.html" class="sidebar-link">ğŸ¤”ä¸€å›¾èƒœåƒè¨€</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>[è¯»ä¹¦ç¬”è®°]æµè§ˆå™¨å·¥ä½œåŸç†ä¸å®æˆ˜</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/100_readingNotes/browser/macroPerspective.html" class="sidebar-link">ğŸ¤”å®è§‚è§†è§’ä¸‹çš„æµè§ˆå™¨</a></li><li><a href="/articles/100_readingNotes/browser/executionMechanism.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨ä¸­çš„JavaScriptæ‰§è¡Œæœºåˆ¶</a></li><li><a href="/articles/100_readingNotes/browser/howV8Works.html" class="sidebar-link">ğŸ¤”V8å·¥ä½œåŸç†</a></li><li><a href="/articles/100_readingNotes/browser/eventLoop.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨ä¸­çš„é¡µé¢å¾ªç¯ç³»ç»Ÿ</a></li><li><a href="/articles/100_readingNotes/browser/pageInBrowser.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨ä¸­çš„é¡µé¢</a></li><li><a href="/articles/100_readingNotes/browser/networkInBrowser.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨ä¸­çš„ç½‘ç»œ</a></li><li><a href="/articles/100_readingNotes/browser/browserSecurity.html" class="sidebar-link">ğŸ¤”æµè§ˆå™¨å®‰å…¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ ‡å‡†åº“</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/004_javascript/standardLibrary/array.html" class="sidebar-link">ğŸ¤”Array</a></li><li><a href="/articles/004_javascript/standardLibrary/object.html" class="sidebar-link">ğŸ¤”Object</a></li><li><a href="/articles/004_javascript/standardLibrary/promise.html" class="sidebar-link">ğŸ¤”Promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/004_javascript/004002_aboutLazyMan.html" class="sidebar-link">ğŸ“ä¸€ä¸ªå…³äºLazyMançš„æ•…äº‹</a></li><li><a href="/articles/004_javascript/004003_arrayPrototypeReduce.html" class="sidebar-link">â­ï¸æµ…æArray.prototype.reduce</a></li><li><a href="/articles/004_javascript/004007_aboutReduce.html" class="sidebar-link">ğŸ“reduceç”¨æ³•æ€»ç»“</a></li><li><a href="/articles/004_javascript/004004_debounceAndThrottle.html" class="sidebar-link">â­ï¸é˜²æŠ–ä¸èŠ‚æµ</a></li><li><a href="/articles/004_javascript/004005_jsonStringify.html" class="sidebar-link">â­ï¸JSON.stringifyæ€»ç»“</a></li><li><a href="/articles/004_javascript/004006_promiseLimit.html" class="sidebar-link">â­ï¸Promiseå¹¶å‘æ§åˆ¶</a></li><li><a href="/articles/004_javascript/004008_extensionCompare.html" class="sidebar-link">ğŸ“ç»§æ‰¿å¯¹æ¯”</a></li><li><a href="/articles/004_javascript/004009_eventloopInBrowserOrNodejs.html" class="sidebar-link">ğŸ“æµè§ˆå™¨ä¸nodejsä¸­çš„äº‹ä»¶å¾ªç¯</a></li><li><a href="/articles/004_javascript/004010_completeAssign.html" class="sidebar-link">å¯ä»¥æ‹·è´å±æ€§æè¿°ç¬¦çš„Object.assign</a></li><li><a href="/articles/004_javascript/004011_createAndAssignInExtends.html" class="sidebar-link">Object.createå’ŒObject.assignåœ¨ç»§æ‰¿ä¸­çš„åˆ©ç”¨</a></li><li><a href="/articles/004_javascript/clone.html" class="sidebar-link">æ·±æ‹·è´æµ…æ</a></li><li><a href="/articles/004_javascript/eventloop.html" class="sidebar-link">JavaScriptå¹¶å‘æ¨¡å‹EventLoopå¯è§†åŒ–æè¿°</a></li><li><a href="/articles/004_javascript/nextTick.html" class="sidebar-link">ä»EventLoopçœ‹Vueçš„nextTick</a></li><li><a href="/articles/004_javascript/fireEvent.html" class="sidebar-link">è‡ªå®šä¹‰äº‹ä»¶</a></li><li><a href="/articles/004_javascript/operatorPrecedence.html" class="sidebar-link">æ“ä½œç¬¦çš„ä¼˜å…ˆçº§</a></li><li><a href="/articles/004_javascript/templateEngineWith50LinesOfCode.html" class="sidebar-link">50è¡Œä»£ç çš„JSæ¨¡æ¿å¼•æ“</a></li><li><a href="/articles/004_javascript/operatorIn.html" class="sidebar-link">in è¿ç®—ç¬¦</a></li><li><a href="/articles/004_javascript/momentjs.html" class="sidebar-link">å®‰åˆ©ä¸€ä¸ªæ—¶é—´æ ¼å¼åŒ–æ’ä»¶</a></li><li><a href="/articles/004_javascript/functionOverload.html" class="sidebar-link">å‡½æ•°çš„é‡è½½</a></li><li><a href="/articles/004_javascript/004013_80percent.html" class="sidebar-link">â­ï¸[è¯»]80%åº”è˜è€…ä¸åŠæ ¼ç³»åˆ—ï¼šé—­åŒ…</a></li><li><a href="/articles/004_javascript/004014_advantagesOfVirtualDom.html" class="sidebar-link">ç½‘ä¸Šéƒ½è¯´æ“ä½œçœŸå® DOM æ…¢ï¼Œä½†æµ‹è¯•ç»“æœå´æ¯” React æ›´å¿«ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‡½æ•°å¼ç¼–ç¨‹</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/004_javascript/functional/compose.html" class="sidebar-link">compose</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Polyfill</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/004_javascript/polyfill/mypromise.html" class="sidebar-link">My Promise polyfill (undone</a></li><li><a href="/articles/004_javascript/polyfill/promise.html" class="sidebar-link">Promise polyfill from community</a></li><li><a href="/articles/004_javascript/polyfill/bind.html" class="sidebar-link">Function.prototype.bind</a></li><li><a href="/articles/004_javascript/polyfill/call.html" class="sidebar-link">Function.prototype.call</a></li><li><a href="/articles/004_javascript/polyfill/apply.html" class="sidebar-link">Function.prototype.apply</a></li><li><a href="/articles/004_javascript/polyfill/new.html" class="sidebar-link">new</a></li><li><a href="/articles/004_javascript/polyfill/const.html" class="sidebar-link">const</a></li><li><a href="/articles/004_javascript/polyfill/instanceof.html" class="sidebar-link">instanceof</a></li><li><a href="/articles/004_javascript/polyfill/create.html" class="sidebar-link">Object.assign</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å·¥ç¨‹åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/011_engineering/011001_optimize.html" class="sidebar-link">ğŸ“ä¼˜åŒ–</a></li><li><a href="/articles/011_engineering/011002_hmr.html" class="sidebar-link">ğŸ“HMR</a></li><li><a href="/articles/011_engineering/011003_devServer.html" class="sidebar-link">ğŸ“devServer</a></li><li><a href="/articles/011_engineering/011004_babel.html" class="sidebar-link">ğŸ“Babelä½¿ç”¨æ€»ç»“</a></li><li><a href="/articles/011_engineering/011006_feSeamlessBuryingPoint.html" class="sidebar-link">[è¯»]200è¡Œä»£ç å®ç°å‰ç«¯æ— ç—•åŸ‹ç‚¹</a></li><li><a href="/articles/011_engineering/011007_skeletonScreenSolution.html" class="sidebar-link">éª¨æ¶å±æ–¹æ¡ˆ</a></li><li><a href="/articles/011_engineering/011008_vueProjectPerformanceOptimization.html" class="sidebar-link">[è¯»]Vueé¡¹ç›®Webpackä¼˜åŒ–å®è·µï¼Œæ„å»ºæ•ˆç‡æé«˜50%</a></li><li><a href="/articles/011_engineering/011009_gitBestPractices.html" class="sidebar-link">Gitæ ‡å‡†åŒ–å®è·µ</a></li><li><a href="/articles/011_engineering/011010_microFe.html" class="sidebar-link">å¾®å‰ç«¯æ€»ç»“</a></li><li><a href="/articles/011_engineering/011011_upload.html" class="sidebar-link">æ–‡ä»¶ä¸Šä¼ çš„å‡ ç§æ–¹å¼</a></li><li><a href="/articles/011_engineering/011012_webpack.html" class="sidebar-link">webpack çŸ¥è¯†ç‚¹</a></li><li><a href="/articles/011_engineering/011013_i18ntester.html" class="sidebar-link">ä½¿ç”¨e2eæµ‹è¯•å·¥å…·nightwatchæ£€æµ‹å°è¯­ç§ç‰ˆæœ¬å›½é™…åŒ–å¼‚å¸¸</a></li><li><a href="/articles/011_engineering/011014_performanceOptimization.html" class="sidebar-link">webpackæ€§èƒ½ä¼˜åŒ–</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ¨¡å—åŒ–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/004_javascript/modularization/AMD.html" class="sidebar-link">AMD</a></li><li><a href="/articles/004_javascript/modularization/CMD.html" class="sidebar-link">CMD</a></li><li><a href="/articles/004_javascript/modularization/CJS.html" class="sidebar-link">CJS</a></li><li><a href="/articles/004_javascript/modularization/ESM.html" class="sidebar-link">ESM</a></li><li><a href="/articles/004_javascript/modularization/UMD.html" class="sidebar-link">UMD</a></li><li><a href="/articles/004_javascript/modularization/commonjsAndAmdAndEs6module.html" class="sidebar-link">CJSã€AMDã€CMDä¸ESMå¯¹æ¯”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ECMAScript6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/005_es6/005001_stringExtension.html" class="sidebar-link">â­ï¸å­—ç¬¦ä¸²çš„æ‰©å±•</a></li><li><a href="/articles/005_es6/005002_stringMethods.html" class="sidebar-link">â­ï¸å­—ç¬¦ä¸²çš„æ–°å¢æ–¹æ³•</a></li><li><a href="/articles/005_es6/005003_numberExtension.html" class="sidebar-link">â­ï¸æ•°å€¼çš„æ‰©å±•</a></li><li><a href="/articles/005_es6/005004_functionExtension.html" class="sidebar-link">â­ï¸å‡½æ•°çš„æ‰©å±•</a></li><li><a href="/articles/005_es6/005005_arrayMethods.html" class="sidebar-link">â­ï¸æ•°ç»„çš„æ–¹æ³•</a></li><li><a href="/articles/005_es6/005006_objectExtension.html" class="sidebar-link">â­ï¸å¯¹è±¡çš„æ‰©å±•</a></li><li><a href="/articles/005_es6/005007_objectMethods.html" class="sidebar-link">ğŸ“å¯¹è±¡çš„æ–¹æ³•</a></li><li><a href="/articles/005_es6/005008_symbol.html" class="sidebar-link">ğŸ“Symbol</a></li><li><a href="/articles/005_es6/005009_setmap.html" class="sidebar-link">ğŸ“Set &amp; Map</a></li><li><a href="/articles/005_es6/005010_proxy.html" class="sidebar-link">â­ï¸Proxy</a></li><li><a href="/articles/005_es6/005011_reflect.html" class="sidebar-link">â­ï¸Reflect</a></li><li><a href="/articles/005_es6/005012_promise.html" class="sidebar-link">ğŸ“Promise</a></li><li><a href="/articles/005_es6/005013_generator.html" class="sidebar-link">â­ï¸Generatorå‡½æ•°ï¼šåè®®ä¸è¯­æ³•</a></li><li><a href="/articles/005_es6/005014_generator.html" class="sidebar-link">â­ï¸Generatorå‡½æ•°ï¼šå¼‚æ­¥åº”ç”¨</a></li><li><a href="/articles/005_es6/005015_generator.html" class="sidebar-link">â­ï¸Generatorå‡½æ•°ï¼šcoæ¨¡å—æµ…æ</a></li><li><a href="/articles/005_es6/005016_async.html" class="sidebar-link">ğŸ“asyncå‡½æ•°</a></li><li><a href="/articles/005_es6/005017_class.html" class="sidebar-link">ğŸ“class</a></li><li><a href="/articles/005_es6/005018_module.html" class="sidebar-link">ğŸ“module</a></li><li><a href="/articles/005_es6/005019_decorator.html" class="sidebar-link">ğŸ“Decorator</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML5</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/002_browser/002001_newFeaturesOfHTML5.html" class="sidebar-link">â­ï¸HTML5æ–°ç‰¹æ€§</a></li><li><a href="/articles/002_browser/002003_historyApi.html" class="sidebar-link">â­ï¸History API</a></li><li><a href="/articles/002_browser/002004_performanceApi.html" class="sidebar-link">â­ï¸Performance API</a></li><li><a href="/articles/002_browser/002005_storageApi.html" class="sidebar-link">â­ï¸LocalStorage &amp; SessionStorage API</a></li><li><a href="/articles/002_browser/002006_event.html" class="sidebar-link">â­ï¸Eventå¯¹è±¡</a></li><li><a href="/articles/002_browser/002002_draggableApi.html" class="sidebar-link">Draggable API</a></li><li><a href="/articles/002_browser/002007_intersectionObserverApi.html" class="sidebar-link">Intersection Observer API</a></li><li><a href="/articles/002_browser/002008_messageChannelApi.html" class="sidebar-link">MessageChannel API</a></li><li><a href="/articles/002_browser/002009_performanceApiAndHtmlLifecycle.html" class="sidebar-link">â­ï¸Performance API ä¸ HTMLæ–‡æ¡£çš„ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="/articles/002_browser/002010_rasterization.html" class="sidebar-link">ğŸ¤”æ¸²æŸ“æµæ°´çº¿ä¸­çš„å…‰æ …åŒ–</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/003_layout/003001_flex.html" class="sidebar-link">â­ï¸Flexç¬”è®°</a></li><li><a href="/articles/003_layout/003002_generalLayoutScheme.html" class="sidebar-link">â­ï¸å¸¸è§„å¸ƒå±€æ–¹æ¡ˆæ€»ç»“</a></li><li><a href="/articles/003_layout/003003_position.html" class="sidebar-link">â­ï¸positionå±æ€§è§£æ</a></li><li><a href="/articles/003_layout/003004_grailLayout.html" class="sidebar-link">â­ï¸åœ£æ¯ä¸åŒé£ç¿¼</a></li><li><a href="/articles/003_layout/003005_pointerEvents.html" class="sidebar-link">â­ï¸ç¥å¥‡çš„pointer-events</a></li><li><a href="/articles/003_layout/css3GpuHardwareAccelerated.html" class="sidebar-link">CSS3çš„GPUåŠ é€Ÿæµ…æ</a></li><li><a href="/articles/003_layout/cssDebuggerWithOneLineCode.html" class="sidebar-link">ä¸€è¡ŒCSSè°ƒè¯•ä»£ç </a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰ç«¯</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/006_frontend/006001_frommemorycacheAndFromdiskcache.html" class="sidebar-link">â­ï¸from memory cacheä¸from disk cacheè¯¦è§£</a></li><li><a href="/articles/006_frontend/curl.html" class="sidebar-link">CURLå¸¸ç”¨çš„åç§æ–¹å¼</a></li><li><a href="/articles/006_frontend/mime.html" class="sidebar-link">å¤šç”¨é€”Interneté‚®ä»¶æ‰©å±•ï¼ˆMIMEï¼‰ç±»å‹</a></li><li><a href="/articles/006_frontend/wireshark.html" class="sidebar-link">Wiresharkçš„ä½¿ç”¨ç¬”è®°</a></li><li><a href="/articles/006_frontend/dollarInChrome.html" class="sidebar-link">JavaScriptä¸­çš„$$(*)ä»£è¡¨ä»€ä¹ˆå’Œ$é€‰æ‹©å™¨çš„ç”±æ¥</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç½‘ç»œåè®®</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/007_networkProtocol/007001_cookie.html" class="sidebar-link">â­ï¸HTTP Cookie</a></li><li><a href="/articles/007_networkProtocol/007002_httpNote.html" class="sidebar-link">â­ï¸å›¾è§£HTTPè¯»ä¹¦ç¬”è®°</a></li><li><a href="/articles/007_networkProtocol/007003_queryStringAndFormDataAndRequestPayload.html" class="sidebar-link">â­ï¸Query String &amp; Form Data &amp; Request Payload</a></li><li><a href="/articles/007_networkProtocol/007004_tcp.html" class="sidebar-link">ğŸ“TCPåè®®ç¬”è®°</a></li><li><a href="/articles/007_networkProtocol/007005_https.html" class="sidebar-link">ğŸ“HTTPSç¬”è®°</a></li><li><a href="/articles/007_networkProtocol/007006_http2.html" class="sidebar-link">ğŸ“HTTP2.0ç¬”è®°</a></li><li><a href="/articles/007_networkProtocol/007007_websocket.html" class="sidebar-link">ğŸ“Websocketåè®®ç¬”è®°</a></li><li><a href="/articles/007_networkProtocol/007008_requestProcess.html" class="sidebar-link">ğŸ“ä»è¾“å…¥URLåˆ°ç•Œé¢å±•ç¤ºè¿‡ç¨‹</a></li><li><a href="/articles/007_networkProtocol/007009_httpCache.html" class="sidebar-link">â­ï¸HTTPç¼“å­˜æ–¹æ¡ˆ</a></li><li><a href="/articles/007_networkProtocol/localhostAnd127.0.0.1.html" class="sidebar-link">localhostå’Œ127.0.0.1çš„åŒºåˆ«</a></li><li><a href="/articles/007_networkProtocol/007010_tcp.html" class="sidebar-link">æ•°æ®åŒ…å¤§å°å¯¹ç½‘ç»œçš„å½±å“ â€”â€” MTU ä¸ MSS çš„å¥¥ç§˜</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ç®—æ³•</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/008_algorithm/008001_complexity.html" class="sidebar-link">ğŸ“å¤æ‚åº¦åˆ†æè§„åˆ™</a></li><li><a href="/articles/008_algorithm/008002_arraySort.html" class="sidebar-link">â­ï¸æ•°ç»„æ’åº</a></li><li><a href="/articles/008_algorithm/008003_arrayFlat.html" class="sidebar-link">ğŸ“æ•°ç»„æ‰å¹³åŒ–</a></li><li><a href="/articles/008_algorithm/008004_dynamicProgramming.html" class="sidebar-link">ğŸ“åŠ¨æ€è§„åˆ’ç®—æ³•é¢˜è‰ç¨¿</a></li><li><a href="/articles/008_algorithm/008005_draft.html" class="sidebar-link">ğŸ“ç®—æ³•é¢˜è‰ç¨¿</a></li><li><a href="/articles/008_algorithm/008006_dataStructure.html" class="sidebar-link">ğŸ“æ•°æ®ç»“æ„</a></li><li><a href="/articles/008_algorithm/008007_arraySortPlus.html" class="sidebar-link">ğŸ“æ•°ç»„æ’åºå†æ€»ç»“</a></li><li><a href="/articles/008_algorithm/008009_binaryTree.html" class="sidebar-link">ğŸ“äºŒå‰æ ‘</a></li><li><a href="/articles/008_algorithm/008010_summary.html" class="sidebar-link">æ•°æ®ç»“æ„ä¸ç®—æ³•æ€»ç»“</a></li><li><a href="/articles/008_algorithm/otherArrayOperations.html" class="sidebar-link">å…¶ä»–æ•°ç»„æ“ä½œ</a></li><li><a href="/articles/008_algorithm/interviewQuestion.html" class="sidebar-link">ä¸€äº›é¢è¯•é¢˜å§ç®—æ˜¯</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nodejs</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/009_node/009001_koa-compose.html" class="sidebar-link">â—ï¸koa-composeæµ…æ</a></li><li><a href="/articles/009_node/009002_nodebestpractices.html" class="sidebar-link">Node.js æœ€ä½³å®è·µ</a></li><li><a href="/articles/009_node/nodemodule.html" class="sidebar-link">æ·±å…¥NodeJsæ¨¡å—ç³»ç»Ÿ</a></li><li><a href="/articles/009_node/packagejsonMainModueAndBrowser.html" class="sidebar-link">æ¨¡å—å…¥å£æ–‡ä»¶ä¼˜å…ˆçº§</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>æ¡†æ¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/010_framework/010001_snabbdomCodeReview.html" aria-current="page" class="active sidebar-link">â­ï¸snabbdomæºç åˆ†æ</a></li><li><a href="/articles/010_framework/010002_vueCli3.html" class="sidebar-link">ğŸ“VueCli3ä½¿ç”¨æ€»ç»“</a></li><li><a href="/articles/010_framework/010003_vueMini.html" class="sidebar-link">ğŸ“ä»0åˆ°0.1å®ç°ä¸€ä¸ªVuejs mini</a></li><li><a href="/articles/010_framework/010004_reactQA.html" class="sidebar-link">reactå¸¸è§é—®é¢˜æ€»ç»“</a></li><li><a href="/articles/010_framework/vueAsyncErrorHandler.html" class="sidebar-link">Vueä¸­å¼‚æ­¥å‡½æ•°çš„å¼‚å¸¸æ•è·æ¢è®¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue Code Review</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/010_framework/vueCodeReview/010001001_codereview.html" class="sidebar-link">ğŸ“Vueæºç è§£æï¼ˆä¸€ï¼‰ï¼šä¸»æµç¨‹</a></li><li><a href="/articles/010_framework/vueCodeReview/010001002_codereview.html" class="sidebar-link">ğŸ“Vueæºç è§£æï¼ˆäºŒï¼‰ï¼šå“åº”å¼å¤„ç†</a></li><li><a href="/articles/010_framework/vueCodeReview/010001003_codereview.html" class="sidebar-link">ğŸ“Vueæºç è§£æï¼ˆä¸‰ï¼‰ï¼šæ›´æ–°æµç¨‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å‰ç«¯å®‰å…¨</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/012_webSecurity/012001_xss.html" class="sidebar-link">â­ï¸XSS</a></li><li><a href="/articles/012_webSecurity/012002_csrf.html" class="sidebar-link">â­ï¸CSRF</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>[è¯»ä¹¦ç¬”è®°]ä½ ä¸çŸ¥é“çš„JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/100_readingNotes/uDontKnowJs/FirstVolumeChapterOne.html" class="sidebar-link">ä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸Šå·ï¼‰</a></li><li><a href="/articles/100_readingNotes/uDontKnowJs/SecondVolumeChapterOne.html" class="sidebar-link">ä½ ä¸çŸ¥é“çš„JavaScriptï¼ˆä¸­å·ï¼‰</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>[è¯»ä¹¦ç¬”è®°]HTTPæƒå¨æŒ‡å—</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/100_readingNotes/theDefinitiveGuide4http/theDefinitiveGuide4http.html" class="sidebar-link">HTTPæƒå¨æŒ‡å—</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>[è¯»ä¹¦ç¬”è®°]é«˜çº§ç¨‹åºè®¾è®¡</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/100_readingNotes/professional/chapter6.html" class="sidebar-link">é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡</a></li><li><a href="/articles/100_readingNotes/professional/chapter7.html" class="sidebar-link">å‡½æ•°è¡¨è¾¾å¼</a></li><li><a href="/articles/100_readingNotes/professional/chapter13.html" class="sidebar-link">äº‹ä»¶</a></li><li><a href="/articles/100_readingNotes/professional/chapter14.html" class="sidebar-link">è¡¨å•è„šæœ¬</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>è®¡ç®—æœºåŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/articles/300_computer/base.html" class="sidebar-link">è®¡ç®—æœºåŸºç¡€</a></li><li><a href="/articles/300_computer/300001_ipc.html" class="sidebar-link">è¿›ç¨‹é—´é€šä¿¡çš„å‡ ç§æ–¹å¼</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="snabbdomæºç åˆ†æ"><a href="#snabbdomæºç åˆ†æ" class="header-anchor">#</a> â­ï¸snabbdomæºç åˆ†æ</h1> <p></p><div class="table-of-contents"><ul><li><a href="#ç›®å½•ç»“æ„">ç›®å½•ç»“æ„</a></li><li><a href="#ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href="#æ¨¡å—ç³»ç»Ÿ">æ¨¡å—ç³»ç»Ÿ</a></li><li><a href="#æºç åˆ†æ">æºç åˆ†æ</a><ul><li><a href="#hå‡½æ•°">hå‡½æ•°</a></li><li><a href="#vnodeç»“æ„">Vnodeç»“æ„</a></li><li><a href="#å…¥å£api">å…¥å£api</a></li><li><a href="#patchå‡½æ•°-å³renderå…¥å£å‡½æ•°">patchå‡½æ•° å³renderå…¥å£å‡½æ•°</a></li><li><a href="#patchvnodeå‡½æ•°">patchVnodeå‡½æ•°</a></li><li><a href="#updatechildrenåŒçº§æ¯”å¯¹ç®—æ³•-diffç®—æ³•æ ¸å¿ƒ">updateChildrenåŒçº§æ¯”å¯¹ç®—æ³• diffç®—æ³•æ ¸å¿ƒ</a></li><li><a href="#addvnodeså‡½æ•°">addVnodeså‡½æ•°</a></li><li><a href="#createelmå‡½æ•°">createElmå‡½æ•°</a></li><li><a href="#removevnodeå‡½æ•°">removeVnodeå‡½æ•°</a></li></ul></li><li><a href="#diffç®—æ³•å›¾ç¤º">diffç®—æ³•å›¾ç¤º</a></li><li><a href="#patchvnodeæ ¸å¿ƒæµç¨‹">patchVnodeæ ¸å¿ƒæµç¨‹</a></li></ul></div><p></p> <h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="header-anchor">#</a> ç›®å½•ç»“æ„</h2> <div class="language- extra-class"><pre class="language-text"><code>|-- snabbdom
    |-- h.js                    - vnodeç”Ÿæˆæ¨¡å—
    |-- htmldomapi.js           - domæ“ä½œapi
    |-- is.js                   - ç±»å‹åˆ¤æ–­
    |-- snabbdom.js             - ä¸»æ¨¡å—
    |-- thunk.js                - thunkæ¨¡å—
    |-- vnode.js                - vnodeå·¥å‚å‡½æ•°
    |-- helpers                 - å¸®åŠ©å‡½æ•°
    |   |-- attachto.js
    |-- modules                 - èŠ‚ç‚¹æ•°æ®å¤„ç†æ¨¡å—
    |   |-- attributes.js       - å¤„ç†å±æ€§
    |   |-- class.js            - å¤„ç†ç±»å
    |   |-- dataset.js          - å¤„ç†è‡ªå®šä¹‰æ•°æ®å±æ€§
    |   |-- eventlisteners.js   - å¤„ç†äº‹ä»¶ç›‘å¬
    |   |-- hero.js             - å¤„ç†è¿‡æ¸¡æ•ˆæœ
    |   |-- props.js            - å¤„ç†
    |   |-- style.js            - å¤„ç†å†…è”æ ·å¼
    |-- perf                    - æ€§èƒ½æ¨¡å—
        |-- benchmarks.js
        |-- index.html
</code></pre></div><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> ç”Ÿå‘½å‘¨æœŸ</h2> <p><strong>æ€»è§ˆ</strong></p> <table><thead><tr><th>åç§°</th> <th>ä½•æ—¶è§¦å‘</th> <th>å›è°ƒå‚æ•°</th></tr></thead> <tbody><tr><td>pre</td> <td>è¡¥ä¸ç¨‹åºå¼€å§‹</td> <td>æ²¡æœ‰</td></tr> <tr><td>init</td> <td>å·²æ·»åŠ ä¸€ä¸ªvnode</td> <td>vnode</td></tr> <tr><td>create</td> <td>å·²åŸºäºvnodeåˆ›å»ºäº†ä¸€ä¸ªDOMå…ƒç´ </td> <td>emptyVnode, vnode</td></tr> <tr><td>insert</td> <td>å…ƒç´ å·²æ’å…¥DOM</td> <td>vnode</td></tr> <tr><td>prepatch</td> <td>å…ƒç´ å³å°†è¢«ä¿®è¡¥</td> <td>oldVnode, vnode</td></tr> <tr><td>update</td> <td>å…ƒç´ æ­£åœ¨æ›´æ–°</td> <td>oldVnode, vnode</td></tr> <tr><td>postpatch</td> <td>å…ƒç´ å·²è¢«ä¿®è¡¥</td> <td>oldVnode, vnode</td></tr> <tr><td>destroy</td> <td>ä¸€ä¸ªå…ƒç´ è¢«ç›´æ¥æˆ–é—´æ¥åˆ é™¤</td> <td>vnode</td></tr> <tr><td>remove</td> <td>å…ƒç´ ç›´æ¥ä»DOMä¸­åˆ é™¤</td> <td>vnode, removeCallback</td></tr> <tr><td>post</td> <td>ä¿®è¡¥ç¨‹åºå®Œæˆ</td> <td>æ²¡æœ‰</td></tr></tbody></table> <p>ä¸‹é¢çš„hookå¯ç”¨äºæ¨¡å—ï¼špreï¼Œcreateï¼Œupdateï¼Œdestroyï¼Œremoveï¼Œpostã€‚</p> <p>ä¸‹é¢çš„hookå¯ç”¨äºå•ä¸ªèŠ‚ç‚¹å±æ€§ï¼ˆå¯è§†ä¸ºä¸šåŠ¡é’©å­ï¼‰ï¼šinitï¼Œcreateï¼Œinsertï¼Œprepatchï¼Œupdateï¼Œpostpatchï¼Œdestroyï¼Œremoveã€‚</p> <h2 id="æ¨¡å—ç³»ç»Ÿ"><a href="#æ¨¡å—ç³»ç»Ÿ" class="header-anchor">#</a> æ¨¡å—ç³»ç»Ÿ</h2> <p>snabbdomé€šè¿‡æ¨¡å—æœºåˆ¶è§£è€¦ï¼Œåœ¨èŠ‚ç‚¹æ•°æ®ä¸­ï¼Œå¦‚æœæœ‰ç›¸åº”çš„èŠ‚ç‚¹æ•°æ®éœ€è¦åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œåªéœ€è¦æŒ‡å®šç”Ÿå‘½å‘¨æœŸé’©å­ä¸Šéƒ¨ç½²å›è°ƒï¼Œå³ä¼šåœ¨vnodeåˆ›å»ºæˆ–è€…æ›´æ–°çš„è¿‡ç¨‹ä¸­è¢«ç›¸åº”çš„è°ƒç”¨ï¼Œå®Œæˆå¯¹èŠ‚ç‚¹æ•°æ®çš„å¤„ç†ã€‚ç›®å‰å®˜æ–¹æ”¯æŒçš„æ¨¡å—å¤„ç†å™¨æœ‰å¦‚ä¸‹7ä¸ªï¼š</p> <ul><li>attributes.js       - å¤„ç†å±æ€§</li> <li>class.js            - å¤„ç†ç±»å</li> <li>dataset.js          - å¤„ç†è‡ªå®šä¹‰æ•°æ®å±æ€§</li> <li>eventlisteners.js   - å¤„ç†äº‹ä»¶ç›‘å¬</li> <li>hero.js             - å¤„ç†è¿‡æ¸¡æ•ˆæœ</li> <li>props.js            - å¤„ç†</li> <li>style.js            - å¤„ç†å†…è”æ ·å¼</li></ul> <p>åŒæ—¶å®˜æ–¹ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ¨¡å—å¤„ç†å™¨å¯¹è™šæ‹ŸèŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼Œåªè¦è¾“å‡ºæ¥å£ç¬¦åˆä¸Šé¢ç”Ÿå‘½å‘¨æœŸä¸­æ‰€ç¤ºçš„è§„èŒƒå³å¯ã€‚</p> <h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="header-anchor">#</a> æºç åˆ†æ</h2> <h3 id="hå‡½æ•°"><a href="#hå‡½æ•°" class="header-anchor">#</a> hå‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hå‡½æ•°ï¼švnodeç”Ÿæˆå™¨</span>
<span class="token comment">// @param sel é€‰æ‹©å™¨</span>
<span class="token comment">// @param b èŠ‚ç‚¹dataæ•°æ®</span>
<span class="token comment">// @param c childrenå­èŠ‚ç‚¹é›†åˆ</span>
<span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
  <span class="token comment">// cå­˜åœ¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// bå°±æ˜¯data</span>
    data <span class="token operator">=</span> b<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœcæ˜¯æ•°ç»„è¯´æ˜æ˜¯å­èŠ‚ç‚¹é›†åˆ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> children <span class="token operator">=</span> c<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœcæ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—è¯´æ˜æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> text <span class="token operator">=</span> c<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token comment">// bå­˜åœ¨ cä¸å­˜åœ¨</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœbæ˜¯æ•°ç»„è¯´æ˜æ˜¯å­èŠ‚ç‚¹é›†åˆ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> children <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœbæ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—è¯´æ˜æ˜¯æ–‡æœ¬èŠ‚ç‚¹</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> text <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token comment">// å¦åˆ™bæ˜¯data</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span> data <span class="token operator">=</span> b<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å¦‚æœè¯´å­èŠ‚ç‚¹æ˜¯æ•°ç»„</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// è€Œä¸”æ¯ä¸€é¡¹æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­— ç›´æ¥åˆ›å»ºæ–‡æœ¬vnodeèŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">VNode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// svg helper</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>sel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'s'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'v'</span> <span class="token operator">&amp;&amp;</span> sel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'g'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">addNS</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> sel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// è¿”å›vnode</span>
  <span class="token keyword">return</span> <span class="token function">VNode</span><span class="token punctuation">(</span>sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="vnodeç»“æ„"><a href="#vnodeç»“æ„" class="header-anchor">#</a> Vnodeç»“æ„</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// vnodeå·¥å‚å‡½æ•°</span>
<span class="token comment">// @param sel é€‰æ‹©å™¨</span>
<span class="token comment">// @param data èŠ‚ç‚¹æ•°æ®</span>
<span class="token comment">// @param children å­èŠ‚ç‚¹</span>
<span class="token comment">// @param text æ–‡æœ¬æ•°æ®</span>
<span class="token comment">// @param elm çœŸå®dom</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sel<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">,</span> text<span class="token punctuation">,</span> elm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> key <span class="token operator">=</span> data <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> data<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    sel<span class="token operator">:</span> sel<span class="token punctuation">,</span>
    data<span class="token operator">:</span> data<span class="token punctuation">,</span>
    children<span class="token operator">:</span> children<span class="token punctuation">,</span>
    text<span class="token operator">:</span> text<span class="token punctuation">,</span> 
    elm<span class="token operator">:</span> elm<span class="token punctuation">,</span> 
    key<span class="token operator">:</span> key
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œvnodeä¸»è¦åŒ…å«å¦‚ä¸‹å‡ ä¸ªå±æ€§ï¼š</p> <ul><li>sel - é€‰æ‹©å™¨</li> <li>data - èŠ‚ç‚¹æ•°æ®</li> <li>children - å­èŠ‚ç‚¹</li> <li>text - æ–‡æœ¬æ•°æ®</li> <li>elm - çœŸå®dom</li> <li>key - data.key</li></ul> <h3 id="å…¥å£api"><a href="#å…¥å£api" class="header-anchor">#</a> å…¥å£api</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// init å…¥å£å‡½æ•°</span>
<span class="token comment">// @param modules éœ€è¦è½½å…¥moduleså¯¹èŠ‚ç‚¹dataä¸­å„ç§æ•°æ®è¿›è¡Œå¤„ç†</span>
<span class="token comment">// @param api domæ“ä½œapi</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">modules<span class="token punctuation">,</span> api</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> cbs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// å¦‚æœæœªä¼ å…¥apiå³ä½¿ç”¨å†…ç½®å‡½æ•°é£æ ¼domApi</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>api<span class="token punctuation">)</span><span class="token punctuation">)</span> api <span class="token operator">=</span> domApi<span class="token punctuation">;</span>

  <span class="token comment">// æŒ‚è½½æ¨¡å—é’©å­</span>
  <span class="token comment">// ç”¨äºåœ¨æŒ‡å®šç”Ÿå‘½å‘¨æœŸå¯¹vnodeè¿›è¡Œç›¸åº”æ¨¡å—çš„å¤„ç†</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hooks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> modules<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> cbs<span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>modules<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// åŸºäºæŸä¸ªå…ƒç´ åˆ›å»ºvnode</span>
  <span class="token keyword">function</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span><span class="token parameter">elm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// åˆ›å»ºèŠ‚ç‚¹ç§»é™¤å›è°ƒ</span>
  <span class="token keyword">function</span> <span class="token function">createRmCb</span><span class="token punctuation">(</span><span class="token parameter">childElm<span class="token punctuation">,</span> listeners</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// æ ¹æ®vnodeåˆ›å»ºçœŸå®dom</span>
  <span class="token keyword">function</span> <span class="token function">createElm</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// æ ¹æ®vnodesåˆ›å»ºçœŸå®dom</span>
  <span class="token keyword">function</span> <span class="token function">addVnodes</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> vnodes<span class="token punctuation">,</span> startIdx<span class="token punctuation">,</span> endIdx<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// æ ¹æ®vnodesç§»é™¤çœŸå®dom</span>
  <span class="token keyword">function</span> <span class="token function">removeVnodes</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> vnodes<span class="token punctuation">,</span> startIdx<span class="token punctuation">,</span> endIdx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// åŒçº§æ¯”å¯¹ç®—æ³•</span>
  <span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// æ ¸å¿ƒæ¨¡å—èŠ‚ç‚¹æ¯”å¯¹</span>
  <span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// patchå‡½æ•° - å³renderå‡½æ•°</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="patchå‡½æ•°-å³renderå…¥å£å‡½æ•°"><a href="#patchå‡½æ•°-å³renderå…¥å£å‡½æ•°" class="header-anchor">#</a> patchå‡½æ•° å³renderå…¥å£å‡½æ•°</h3> <p>ä»å…¥å£å‡½æ•°å¯ä»¥çœ‹å‡ºæ–°æ—§èŠ‚ç‚¹æ¯”å¯¹å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªé¡¶çº§èŠ‚ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆvueä¸­.vueæ–‡ä»¶ä¸­å¿…é¡»éœ€è¦åªèƒ½æœ‰ä¸€ä¸ªé¡¶çº§èŠ‚ç‚¹çš„åŸå› ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// patchå‡½æ•°</span>
<span class="token comment">// @param oldVnode æ—§vnode</span>
<span class="token comment">// @param vnode æ–°vnode</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">;</span>
  <span class="token keyword">var</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å¼€å§‹å‰æ¨¡å—preé’©å­è°ƒç”¨</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>pre<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç¬¬ä¸€æ¬¡patchå¤„ç† oldVnodeä¸ºè™šæ‹ŸdomæŒ‚è½½çœŸå®domèŠ‚ç‚¹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœoldVnodeä¸ä¸ºé¡¶çº§èŠ‚ç‚¹</span>
    <span class="token comment">// åˆ™åˆ›å»ºä¸šåŠ¡vnodeä¹‹åï¼Œç›´æ¥å¯¹éœ€è¦æŒ‚è½½çš„çœŸå®domèŠ‚ç‚¹è¿›è¡Œæ›¿æ¢</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>parentElement <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldVnode<span class="token punctuation">.</span>parentElement<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœoldVnodeä¸ºé¡¶çº§èŠ‚ç‚¹</span>
    <span class="token comment">// åˆ™ä»¥oldVnodeåˆ›å»ºè™šæ‹ŸnodeèŠ‚ç‚¹ï¼Œèµ°patchVnodeæµç¨‹</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment">// åç»­patchèŠ‚ç‚¹</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// patchå‡½æ•°å®Œæˆå è°ƒç”¨ä¸šåŠ¡ä»£ç å†…inserté’©å­</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insertedVnodeQueue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>insertedVnodeQueue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// æ¨¡å—posté’©å­å‡½æ•°è°ƒç”¨</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>post<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> vnode<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="patchvnodeå‡½æ•°"><a href="#patchvnodeå‡½æ•°" class="header-anchor">#</a> patchVnodeå‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// patchVnode èŠ‚ç‚¹æ¯”å¯¹</span>
<span class="token comment">// @param oldVnode æ—§vnode</span>
<span class="token comment">// @param vnode æ–°vnode</span>
<span class="token keyword">function</span> <span class="token function">patchVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span> hook<span class="token punctuation">;</span>
  <span class="token comment">// patch Vnodeå‰ ä¸šåŠ¡ä»£ç å†…prepatch hookè°ƒç”¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>hook <span class="token operator">=</span> i<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> hook<span class="token punctuation">.</span>prepatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å¤„ç†data.vnodeç»“æ„</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> oldVnode <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> vnode <span class="token operator">=</span> i<span class="token punctuation">;</span>

  <span class="token comment">// å°†æ—§nodeçš„å…ƒç´ èŠ‚ç‚¹æŒ‚åœ¨æ–°vnodeä¸Š</span>
  <span class="token keyword">var</span> elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span>
      <span class="token comment">// æ—§å­èŠ‚ç‚¹</span>
      oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
      <span class="token comment">// æ–°å­èŠ‚ç‚¹</span>
      ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹ä¸ºåŒä¸€èŠ‚ç‚¹ æ— éœ€æ¯”å¯¹</span>
  <span class="token comment">// è¿™ç§æƒ…å†µéœ€è¦æ–Ÿé…Œä¸€ä¸‹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token comment">// éå¸¸é‡è¦ï¼</span>
  <span class="token comment">// ä¸šåŠ¡ä»£ç ä¸æ¨¡å—å†…update hookè°ƒç”¨</span>
  <span class="token comment">// æ¨¡å—å¤„ç†vnodeæ•°æ®å±æ€§çš„update hookè°ƒç”¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>update<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// å¦‚æœvnodeçš„æ–‡æœ¬èŠ‚ç‚¹ä¸å­˜åœ¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæ–°æ—§èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½å­˜åœ¨ åˆ™èµ°updateChildrenæ›´æ–°æµç¨‹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–°å­èŠ‚ç‚¹å­˜åœ¨æ—§å­èŠ‚ç‚¹ä¸å­˜åœ¨</span>
    <span class="token comment">// åˆ™åˆ›å»ºæ–°å­èŠ‚ç‚¹</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å…¨èŠ‚ç‚¹æ’å…¥</span>
      <span class="token function">addVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ch<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ—§å­èŠ‚ç‚¹å­˜åœ¨æ–°å­èŠ‚ç‚¹ä¸å­˜åœ¨</span>
    <span class="token comment">// åˆ™ç§»é™¤æ—§å­èŠ‚ç‚¹</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å…¨èŠ‚ç‚¹ç§»é™¤</span>
      <span class="token function">removeVnodes</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token comment">// æ–‡æœ¬èŠ‚ç‚¹åˆ‡æ–‡æœ¬å†…å®¹ä¸åŒ</span>
  <span class="token comment">// æ›´æ–°æ–‡æœ¬èŠ‚ç‚¹</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elm<span class="token punctuation">.</span>textContent <span class="token operator">=</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// patchVnodeç»“æŸå ä¸šåŠ¡ä»£ç å†…postpatch hookè°ƒç”¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> hook<span class="token punctuation">.</span>postpatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="updatechildrenåŒçº§æ¯”å¯¹ç®—æ³•-diffç®—æ³•æ ¸å¿ƒ"><a href="#updatechildrenåŒçº§æ¯”å¯¹ç®—æ³•-diffç®—æ³•æ ¸å¿ƒ" class="header-anchor">#</a> updateChildrenåŒçº§æ¯”å¯¹ç®—æ³• diffç®—æ³•æ ¸å¿ƒ</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// updateChildren å­èŠ‚ç‚¹æ¯”å¯¹</span>
<span class="token comment">// @param parentElm çˆ¶çº§çœŸå®dom</span>
<span class="token comment">// @param oldCh æ—§å­èŠ‚ç‚¹</span>
<span class="token comment">// @param newCh æ–°å­èŠ‚ç‚¹</span>
<span class="token keyword">function</span> <span class="token function">updateChildren</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å£°æ˜æ—§å­èŠ‚ç‚¹å¼€å§‹ç´¢å¼•</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ—§å¼€å§‹ç´¢å¼•</span>
  <span class="token keyword">var</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// å£°æ˜æ–°å­èŠ‚ç‚¹å¼€å§‹ç´¢å¼•</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ–°å¼€å§‹ç´¢å¼•</span>
      newStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ—§å­èŠ‚ç‚¹ç»“æŸç´¢å¼•</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ—§ç»“æŸç´¢å¼•</span>
  <span class="token keyword">var</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ–°å­èŠ‚ç‚¹ç»“æŸç´¢å¼•</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ–°ç»“æŸç´¢å¼•</span>
  <span class="token keyword">var</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ—§å¼€å§‹å­èŠ‚ç‚¹</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ—§å¼€å§‹</span>
  <span class="token keyword">var</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ—§ç»“æŸå­èŠ‚ç‚¹</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ—§ç»“æŸ</span>
  <span class="token keyword">var</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ–°å¼€å§‹å­èŠ‚ç‚¹</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ–°å¼€å§‹</span>
  <span class="token keyword">var</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// å£°æ˜æ–°ç»“æŸå­èŠ‚ç‚¹</span>
  <span class="token comment">// ä¸‹é¢ç§°ä¹‹ä¸ºæ–°ç»“æŸ</span>
  <span class="token keyword">var</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">var</span> oldKeyToIdx<span class="token punctuation">,</span>
  idxInOld<span class="token punctuation">,</span>
  elmToMove<span class="token punctuation">,</span>
  before<span class="token punctuation">;</span>

  <span class="token comment">// è·³å‡ºå¾ªç¯æ¡ä»¶ æ—§å¼€å§‹ç´¢å¼• &gt; æ—§ç»“æŸç´¢å¼• æˆ–è€… æ–°å¼€å§‹ç´¢å¼• &gt; è¡Œç»“æŸç´¢å¼•</span>
  <span class="token comment">// -&gt;   &lt;-</span>
  <span class="token comment">// o o o o</span>
  <span class="token comment">// o o o o o</span>
  <span class="token comment">// -&gt;     &lt;-</span>
  <span class="token comment">// å³æ–°èŠ‚ç‚¹æˆ–è€…æ—§èŠ‚ç‚¹ä»¥åŠéå†å®Œäº†</span>
  <span class="token comment">// æƒ…å†µ1ï¼šæ–°èŠ‚ç‚¹å…ˆéå†å®Œï¼Œè¯´æ˜æ—§èŠ‚ç‚¹æ¯”æ–°èŠ‚ç‚¹å¤šï¼Œè¿™ä¸ªæ—¶å€™æ—§èŠ‚ç‚¹æœªéå†åˆ°çš„éœ€è¦ç§»é™¤</span>
  <span class="token comment">// æƒ…å†µ2ï¼šæ—§èŠ‚ç‚¹å…ˆéå†å®Œï¼Œè¯´æ˜æ–°èŠ‚ç‚¹æ¯”æ—§èŠ‚ç‚¹å¤šï¼Œè¿™ä¸ªæ—¶å€™æ–°èŠ‚ç‚¹æœªéå†åˆ°çš„éœ€è¦æ·»åŠ </span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ—§å¼€å§‹èŠ‚ç‚¹ä¸å­˜åœ¨</span>
    <span class="token comment">// å³å‘½ä¸­keyè¢«æŠ½èµ°äº†</span>
    <span class="token comment">// æ—§å¼€å§‹ç´¢å¼•è‡ªå¢ å‘ä¸­é—´é€¼è¿‘ </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Vnode has been moved left</span>
    <span class="token comment">// æ—§ç»“æŸèŠ‚ç‚¹ä¸å­˜åœ¨</span>
    <span class="token comment">// å³å‘½ä¸­keyè¢«æŠ½èµ°äº†</span>
    <span class="token comment">// æ—§ç»“æŸç´¢å¼•è‡ªå‡ å‘ä¸­é—´é€¼è¿‘ </span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// æ—§å¼€å§‹ä¸æ–°å¼€å§‹æ˜¯åŒä¸€èŠ‚ç‚¹</span>
    <span class="token comment">// patchç›¸åŒvnode ç´¢å¼•å¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// æ—§ç»“æŸä¸æ–°ç»“æŸæ˜¯åŒä¸€èŠ‚ç‚¹</span>
    <span class="token comment">// patchç›¸åŒvnode ç´¢å¼•å¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// æ—§å¼€å§‹ä¸æ–°ç»“æŸæ˜¯åŒä¸€èŠ‚ç‚¹</span>
    <span class="token comment">// patchç›¸åŒvnode ç´¢å¼•å¤„ç†</span>
    <span class="token comment">// åŒæ—¶éœ€è¦å°†æ—§å¼€å§‹çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°æ—§ç»“æŸåé¢</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vnode moved right</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">.</span>nextSibling<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// æ—§ç»“æŸä¸æ–°å¼€å§‹æ˜¯åŒä¸€èŠ‚ç‚¹</span>
    <span class="token comment">// patchç›¸åŒvnode ç´¢å¼•å¤„ç†</span>
    <span class="token comment">// åŒæ—¶éœ€è¦å°†æ—§ç»“æŸçš„èŠ‚ç‚¹ç§»åŠ¨åˆ°æ—§å¼€å§‹å‰é¢</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Vnode moved left</span>
      <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// ä»¥ä¸Šæƒ…å†µå‡ä¸å‘½ä¸­</span>
    <span class="token comment">// éœ€è¦ä» æ–°å¼€å§‹å’Œæ—§å¼€å§‹ å¼€å§‹å¤„ç†</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// å»ºç«‹keyä¸indexç´¢å¼•çš„æ˜ å°„å¹¶ç¼“å­˜</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldKeyToIdx<span class="token punctuation">)</span><span class="token punctuation">)</span> oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// æ–°å¼€å§‹èŠ‚ç‚¹æ ¹æ®keyå¯»æ‰¾åœ¨æ—§å­èŠ‚ç‚¹ä¸­çš„ç´¢å¼•</span>
      idxInOld <span class="token operator">=</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœæ²¡æ‰¾åˆ°</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>idxInOld<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// éœ€è¦åœ¨æ—§å¼€å§‹èŠ‚ç‚¹å‰æ’å…¥æ–°åˆ›å»ºçš„èŠ‚ç‚¹</span>
        <span class="token comment">// New element</span>
        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœæ‰¾åˆ°äº†</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹</span>
        elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// patchç›¸åŒvnode</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å°†æ—§èŠ‚ç‚¹æ•°æ®ç½®ä¸ºundefined å³å°†ä¼šå‘½ä¸­å¾ªç¯ä¸­å¼€å§‹çš„é‚£ä¸¤ç§æƒ…å†µ</span>
        oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
        <span class="token comment">// å°†éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹æ’æ—§å¼€å§‹å‰</span>
        parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¤„ç†ç´¢å¼•</span>
        newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// æ—§èŠ‚ç‚¹å…ˆéå†å®Œï¼Œè¯´æ˜æ–°èŠ‚ç‚¹æ¯”æ—§èŠ‚ç‚¹å¤šï¼Œè¿™ä¸ªæ—¶å€™æ–°èŠ‚ç‚¹æœªéå†åˆ°çš„éœ€è¦æ·»åŠ </span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// newEndIdx + 1ä¸å­˜åœ¨éœ€è¦ç½®ä¸ºnullå…¼å®¹domapi</span>
    before <span class="token operator">=</span> <span class="token function">isUndef</span><span class="token punctuation">(</span>newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
    <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ–°èŠ‚ç‚¹å…ˆéå†å®Œï¼Œè¯´æ˜æ—§èŠ‚ç‚¹æ¯”æ–°èŠ‚ç‚¹å¤šï¼Œè¿™ä¸ªæ—¶å€™æ—§èŠ‚ç‚¹æœªéå†åˆ°çš„éœ€è¦ç§»é™¤</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="addvnodeså‡½æ•°"><a href="#addvnodeså‡½æ•°" class="header-anchor">#</a> addVnodeså‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// addVnodes é€šè¿‡ä¸€ç³»åˆ—vnodesåˆ›å»ºçœŸå®dom</span>
<span class="token comment">// @param parentElm éœ€è¦æ·»åŠ èŠ‚ç‚¹çš„çˆ¶åŠèŠ‚ç‚¹</span>
<span class="token comment">// @param before éœ€è¦åœ¨beforeèŠ‚ç‚¹å‰æ’å…¥</span>
<span class="token comment">// @param vnodes éœ€è¦æ’å…¥èŠ‚ç‚¹vnodes</span>
<span class="token comment">// @param startIdx å¼€å§‹ç´¢å¼•</span>
<span class="token comment">// @param endIdx ç»“æŸç´¢å¼•</span>
<span class="token comment">// @param insertedVnodeQueue</span>
<span class="token keyword">function</span> <span class="token function">addVnodes</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> vnodes<span class="token punctuation">,</span> startIdx<span class="token punctuation">,</span> endIdx<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parentElm<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">,</span> before<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="createelmå‡½æ•°"><a href="#createelmå‡½æ•°" class="header-anchor">#</a> createElmå‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// createElm æ ¹æ®vnodeç”ŸæˆçœŸå®domèŠ‚ç‚¹</span>
<span class="token comment">// @param vnode</span>
<span class="token comment">// @return vnode.elm</span>
<span class="token keyword">function</span> <span class="token function">createElm</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> i<span class="token punctuation">,</span>
      data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

  <span class="token comment">// å¤„ç†initä¸šåŠ¡ä»£ç é’©å­ä¸data.vnodeç»“æ„</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> vnode <span class="token operator">=</span> i<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> elm<span class="token punctuation">,</span>
      children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children<span class="token punctuation">,</span>
      sel <span class="token operator">=</span> vnode<span class="token punctuation">.</span>sel<span class="token punctuation">;</span>
  <span class="token comment">// å¦‚æœvnodeä¸­é€‰æ‹©å™¨å­˜åœ¨</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>sel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Parse selector</span>
    <span class="token keyword">var</span> hashIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> dotIdx <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> hashIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> hash <span class="token operator">=</span> hashIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> hashIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">var</span> dot <span class="token operator">=</span> dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> dotIdx <span class="token operator">:</span> sel<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">var</span> tag <span class="token operator">=</span> hashIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> dotIdx <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> sel<span class="token punctuation">;</span>
    <span class="token comment">// èŠ‚ç‚¹ç”Ÿæˆ</span>
    elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>ns<span class="token punctuation">)</span> <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> tag<span class="token punctuation">)</span> <span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç”Ÿæˆid</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hash <span class="token operator">&lt;</span> dot<span class="token punctuation">)</span> elm<span class="token punctuation">.</span>id <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>hash <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> dot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç”Ÿæˆclass</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dotIdx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> elm<span class="token punctuation">.</span>className <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>dot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœå­èŠ‚ç‚¹vnodeæ•°ç»„å­˜åœ¨éœ€è¦é€’å½’æ¬¡å‡½æ•°</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        elm<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">createElm</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token comment">// å¦‚æœvnodeæ–‡æœ¬æ•°æ®å­˜åœ¨åˆ™åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">primitive</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      elm<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// éå¸¸é‡è¦ï¼</span>
    <span class="token comment">// æ¨¡å—å¤„ç†å™¨ä¸­create hookè°ƒç”¨</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">;</span> <span class="token comment">// Reuse variable</span>
    <span class="token comment">// ä¸šåŠ¡ä»£ç createdé’©å­è°ƒç”¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>create<span class="token punctuation">)</span> i<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>insert<span class="token punctuation">)</span> insertedVnodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token comment">// å¦åˆ™åˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="removevnodeå‡½æ•°"><a href="#removevnodeå‡½æ•°" class="header-anchor">#</a> removeVnodeå‡½æ•°</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// removeVnodes æ ¹æ®ä¸€ç³»åˆ—vnodeså°†çœŸå®domä»çˆ¶èŠ‚ç‚¹ä¸­ç§»é™¤</span>
<span class="token comment">// @param parentElm çˆ¶çº§çœŸå®dom</span>
<span class="token comment">// @param vnodes ä¸€ç³»åˆ—vnodes</span>
<span class="token comment">// @param startIdx å¼€å§‹ç´¢å¼•</span>
<span class="token comment">// @param endIdx ç»“æŸç´¢å¼•</span>
<span class="token keyword">function</span> <span class="token function">removeVnodes</span><span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> vnodes<span class="token punctuation">,</span> startIdx<span class="token punctuation">,</span> endIdx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> startIdx <span class="token operator">&lt;=</span> endIdx<span class="token punctuation">;</span> <span class="token operator">++</span>startIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i<span class="token punctuation">,</span>
        listeners<span class="token punctuation">,</span>
        rm<span class="token punctuation">,</span>
        ch <span class="token operator">=</span> vnodes<span class="token punctuation">[</span>startIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœvnodeå­˜åœ¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœvnodeé€‰æ‹©å™¨å­˜åœ¨</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>sel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é€’å½’çš„destroy hookæ‰§è¡Œå™¨</span>
        <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listeners <span class="token operator">=</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”Ÿæˆremoveæƒ°æ€§å‡½æ•° ä¾›ä¸šåŠ¡ä»£ç å†…è°ƒç”¨</span>
        rm <span class="token operator">=</span> <span class="token function">createRmCb</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> listeners<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> cbs<span class="token punctuation">.</span>remove<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœæœ‰ä¸šåŠ¡removeé’©å­</span>
        <span class="token comment">// ä¼ å…¥vnodeä¸åˆ é™¤èŠ‚ç‚¹å‡½æ•° å¯ä¾›ä¸šåŠ¡ä»£ç æ‰§è¡Œå®Œæˆåè°ƒç”¨åˆ é™¤å‡½æ•°åˆ é™¤èŠ‚ç‚¹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> ch<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>remove<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">i</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> rm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¦åˆ™ç›´æ¥ç§»é™¤èŠ‚ç‚¹</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">rm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">// è¯´æ˜æ˜¯æ–‡æœ¬èŠ‚ç‚¹ ç›´æ¥ç§»é™¤å³å¯</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Text node</span>
        parentElm<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>ch<span class="token punctuation">.</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="diffç®—æ³•å›¾ç¤º"><a href="#diffç®—æ³•å›¾ç¤º" class="header-anchor">#</a> diffç®—æ³•å›¾ç¤º</h2> <p>è½¯ä»¶ç”»å›¾å•¥çš„å¤ªéº»çƒ¦äº†ï¼Œè¿˜ä¸å¦‚æ‰‹å†™æ¥çš„ç›´æ¥ã€‚ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥å›¾æ˜¯_(:Ğ·ã€âˆ )_å€’çš„ã€‚ï¼‰
<img src="/img/diff.jpeg" alt=""></p> <h2 id="patchvnodeæ ¸å¿ƒæµç¨‹"><a href="#patchvnodeæ ¸å¿ƒæµç¨‹" class="header-anchor">#</a> patchVnodeæ ¸å¿ƒæµç¨‹</h2> <p><img src="/img/patchVnode.jpeg" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/24/2021, 3:59:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/articles/009_node/packagejsonMainModueAndBrowser.html" class="prev">
        æ¨¡å—å…¥å£æ–‡ä»¶ä¼˜å…ˆçº§
      </a></span> <span class="next"><a href="/articles/010_framework/010002_vueCli3.html">
        ğŸ“VueCli3ä½¿ç”¨æ€»ç»“
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1690ea5b.js" defer></script><script src="/assets/js/2.8b426e0b.js" defer></script><script src="/assets/js/133.77ef3752.js" defer></script>
  </body>
</html>
